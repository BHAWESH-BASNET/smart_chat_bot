<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>SmartChat - Hebrew AI Chatbot</title>
<style>
  * { box-sizing: border-box; margin:0; padding:0; font-family: "Segoe UI", Arial, sans-serif; }

  body {
    display: flex;
    height: 100vh;
    transition: background 0.5s, color 0.5s;
  }

  /* ××¦×‘ ×›×”×” */
  body.dark {
    background: linear-gradient(135deg, #1f1c2c, #928dab);
    color: #f0f0f0;
  }

  /* ××¦×‘ ×‘×”×™×¨ */
  body.light {
    background: linear-gradient(135deg, #dbeafe, #fef9c3);
    color: #222;
  }

  /* ×¡×™×™×“×‘×¨ */
  #sidebar {
    width: 280px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    padding: 20px;
    box-shadow: 2px 0 10px rgba(0,0,0,0.2);
    transition: background 0.5s, color 0.5s;
  }

  #sidebar button {
    background: #1a73e8; color: #fff; border: none;
    padding: 12px; font-size: 14px;
    border-radius: 8px; cursor: pointer;
    margin-bottom: 12px; transition: 0.25s; font-weight:bold;
  }
  #sidebar button:hover { background: #1664c1; }
  #chat-list { list-style:none; flex:1; overflow-y:auto; margin-top:5px; }
  #chat-list li {
    padding: 10px 12px; margin-bottom:6px;
    background: var(--chat-item-bg); border-radius:8px;
    display:flex; justify-content:space-between; align-items:center;
    cursor:pointer; transition:0.2s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  }
  #chat-list li:hover { background: var(--chat-item-hover); }
  #chat-list li.active { background:#1a73e8; color:#fff; font-weight:bold; }
  #chat-list li button {
    background:#d32f2f; border:none; color:white;
    border-radius:4px; padding:2px 6px; cursor:pointer;
    font-size:12px; transition:0.2s;
  }
  #chat-list li button:hover { background:#b71c1c; }

  /* ××–×•×¨ ×¦'××˜ */
  #chat-container {
    flex:1;
    display:flex;
    flex-direction:column;
    padding:20px;
    position: relative;
    transition: background 0.5s, color 0.5s;
  }

  /* ×›×•×ª×¨×ª ×¢×œ×™×•× ×” */
  header {
    display:flex;
    justify-content: space-between;
    align-items:center;
    margin-bottom:15px;
  }
  header h1 {
    font-size: 24px;
    text-shadow: 0 0 8px rgba(26,115,232,0.4);
  }

  #theme-toggle {
    background:none;
    border:none;
    color: inherit;
    font-size: 22px;
    cursor: pointer;
    transition: transform 0.3s;
  }
  #theme-toggle:hover { transform: rotate(15deg); }

  #chat-area {
    flex:1;
    background: var(--chat-bg);
    padding:20px;
    border-radius:12px;
    box-shadow: inset 0 0 8px rgba(0,0,0,0.3);
    overflow-y:auto;
    margin-bottom:15px;
    direction: rtl;
    display:flex; flex-direction: column; gap: 8px;
    transition: background 0.5s, color 0.5s;
  }

  .message {
    max-width:70%;
    padding:12px 18px;
    border-radius:16px;
    word-wrap: break-word;
    line-height:1.5;
    direction: rtl;
    opacity:0;
    transform: translateY(10px);
    animation: fadeInUp 0.3s forwards;
  }
  .user { background:#1a73e8; color:white; align-self:flex-end; border-bottom-right-radius:0; }
  .bot { background:#4caf50; color:white; align-self:flex-start; border-bottom-left-radius:0; }
  .loading { font-style:italic; opacity:0.7; }

  @keyframes fadeInUp { to { opacity:1; transform: translateY(0); } }

  /* × ×§×•×“×•×ª ×˜×¢×™× ×” */
  .dots::after {
    content: '';
    display: inline-block;
    width: 1em;
    text-align: left;
    animation: dots 1s steps(3,end) infinite;
  }
  @keyframes dots {
    0%,20% { content: ''; }
    40% { content: '.'; }
    60% { content: '..'; }
    80%,100% { content: '...'; }
  }

  /* ××–×•×¨ ×§×œ×˜ */
  #input-area { display:flex; }
  #message {
    flex:1; padding:12px; border-radius:10px; border:1px solid var(--border-color); font-size:15px;
    direction: rtl; outline:none; transition:0.2s;
    background: var(--input-bg); color: var(--text-color);
  }
  #message:focus { border-color:#1a73e8; box-shadow:0 0 5px rgba(26,115,232,0.5); }
  #send-btn {
    background:#1a73e8; color:white; border:none;
    padding:0 25px; margin-left:10px; border-radius:10px; cursor:pointer;
    transition:0.2s; font-weight:bold;
  }
  #send-btn:hover { background:#1664c1; }

  /* ××©×ª× ×™× ×œ×¤×™ ××¦×‘ */
  body.dark {
    --sidebar-bg: #2c2f36;
    --chat-bg: #2a2d35;
    --input-bg: #353841;
    --chat-item-bg: #353841;
    --chat-item-hover: #3e4250;
    --border-color: #555;
    --text-color: #fff;
  }

  body.light {
    --sidebar-bg: #ffffff;
    --chat-bg: #f7f9fb;
    --input-bg: #fff;
    --chat-item-bg: #f2f4f7;
    --chat-item-hover: #e8f0fe;
    --border-color: #ccc;
    --text-color: #222;
  }

</style>
</head>
<body class="dark">
<div id="sidebar">
  <button onclick="newChat()">×©×™×—×” ×—×“×©×”</button>
  <ul id="chat-list"></ul>
</div>

<div id="chat-container">
  <header>
    <h1>ğŸ¤– SmartChat</h1>
    <button id="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
  </header>
  <div id="chat-area"></div>
  <div id="input-area">
    <input type="text" id="message" placeholder="×›×ª×•×‘ ×›××Ÿ..." onkeydown="if(event.key==='Enter'){sendMessage()}">
    <button id="send-btn" onclick="sendMessage()">×©×œ×—</button>
  </div>
</div>

<script>
let currentChat = 0;
let darkMode = true;

function toggleTheme(){
  const body = document.body;
  darkMode = !darkMode;
  if(darkMode){
    body.classList.remove('light');
    body.classList.add('dark');
    document.getElementById('theme-toggle').textContent = 'ğŸŒ™';
  } else {
    body.classList.remove('dark');
    body.classList.add('light');
    document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
  }
}

function loadChats(){
  fetch('http://127.0.0.1:5000/chats')
    .then(r=>r.json())
    .then(data=>{
      const list = document.getElementById('chat-list');
      list.innerHTML='';
      data.forEach((chat,i)=>{
        const li=document.createElement('li');
        if(i===currentChat) li.classList.add('active');

        const span=document.createElement('span');
        span.textContent=chat.name;
        span.style.flex='1';

        const delBtn=document.createElement('button');
        delBtn.textContent='ğŸ—‘ï¸';
        delBtn.onclick=(e)=>{
          e.stopPropagation();
          deleteChat(i);
        };

        li.appendChild(span);
        li.appendChild(delBtn);
        li.onclick=()=>{ currentChat=i; renderChat(data[i]); loadChats(); };
        list.appendChild(li);
      });
      if(data.length>0) renderChat(data[currentChat]);
    });
}

function renderChat(chat){
  const area = document.getElementById('chat-area');
  area.innerHTML='';
  chat.messages.forEach(msg=>{
    const div=document.createElement('div');
    div.className='message '+(msg.role==='user'?'user':'bot');
    div.textContent=(msg.role==='user'?'××ª×”: ':'ğŸ¤– ×‘×•×˜: ')+msg.content;
    area.appendChild(div);
  });
  area.scrollTop=area.scrollHeight;
}

function typeBotMessage(area, text) {
  const div = document.createElement('div');
  div.className = 'message bot';
  div.style.opacity = 0;
  div.style.transform = 'translateY(10px)';

  const label = document.createElement('span');
  label.textContent = 'ğŸ¤– ×‘×•×˜: ';
  const content = document.createElement('span');
  div.appendChild(label);
  div.appendChild(content);
  area.appendChild(div);
  area.scrollTop = area.scrollHeight;

  setTimeout(() => {
    div.style.transition = 'opacity 0.3s, transform 0.3s';
    div.style.opacity = 1;
    div.style.transform = 'translateY(0)';

    let i = 0;
    const interval = setInterval(() => {
      content.textContent = text.slice(0, i);
      i++;
      area.scrollTop = area.scrollHeight;
      if (i > text.length) clearInterval(interval);
    }, 30);
  }, 10);
}

function sendMessage(){
  const input = document.getElementById('message');
  const msg = input.value.trim();
  if(!msg) return;

  const area = document.getElementById('chat-area');

  const userDiv = document.createElement('div');
  userDiv.className = 'message user';
  userDiv.textContent = '××ª×”: ' + msg;
  area.appendChild(userDiv);
  area.scrollTop = area.scrollHeight;

  const loadingDiv = document.createElement('div');
  loadingDiv.className='message bot loading dots';
  loadingDiv.textContent='ğŸ¤– ×‘×•×˜';
  area.appendChild(loadingDiv);
  area.scrollTop=area.scrollHeight;

  input.value='';

  fetch(`http://127.0.0.1:5000/chats/${currentChat}/send`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({message: msg})
  })
  .then(r=>r.json())
  .then(data=>{
    area.removeChild(loadingDiv);
    const botResponse = data.reply;
    typeBotMessage(area, botResponse);
  });
}

function newChat(){
  fetch('http://127.0.0.1:5000/chats/new',{method:'POST'})
    .then(r=>r.json())
    .then(()=>loadChats());
}

function deleteChat(index){
  fetch(`http://127.0.0.1:5000/chats/${index}/delete`, { method:'POST' })
    .then(()=>loadChats());
}

loadChats();
</script>
</body>
</html>
